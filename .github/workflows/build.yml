name: Build OPL

on:
  push:
    branches: [ master, main, devel ]
  pull_request:
    branches: [ master, main ]

jobs:
  build:
    runs-on: ubuntu-latest
    container: ps2dev/ps2dev:latest

    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Install dependencies
      run: |
        apk add --no-cache build-base git bash zip python3 py3-pip
        # If clang-format is needed
        # apk add clang

    - name: Download sub-dependencies
      run: |
        chmod +x tools/setup_deps.sh
        ./tools/setup_deps.sh

    - name: Static Checks
      run: |
        chmod +x tools/check.sh
        ./tools/check.sh || true

    - name: Build
      run: |
        chmod +x tools/build.sh
        ./tools/build.sh

    - name: Upload Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: OPL-Builds
        path: artifacts/
